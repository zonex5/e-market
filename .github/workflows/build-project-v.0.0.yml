name: Build and Push Docker Image

env:
  IMAGE_VERSION: 0.0.${{ github.run_number }}

on:
  workflow_dispatch:

jobs:

  # Build jar file
  build-and-push-image:
    runs-on: ubuntu-latest

    permissions:
      actions: read
      contents: read
      security-events: write

    steps:
      # Step 1: Checkout repository
      - name: Checkout repository
        uses: actions/checkout@v3

      # Scan code for vulnerabilities
      - name: Run Trivy vulnerability scanner in repo mode
        uses: aquasecurity/trivy-action@0.28.0
        with:
          scan-type: 'fs'
          ignore-unfixed: false
          format: 'table'
          severity: 'CRITICAL,HIGH'